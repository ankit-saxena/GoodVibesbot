var Twit = require('./lib/twitter.js'),
    config = require('./config1.js');
        ;

var bot = new Twit(config);

// to get tweets and retweet

function datestring () {
    var d = new Date(Date.now());  //est timezone
    return d.getUTCFullYear()   + '-'
        +  (d.getUTCMonth() + 1) + '-'
        +   d.getDate();
};


setInterval(function()
{

    bot.get('search/tweets', { q: '#goodvibes viber since:2014-06-19', count: 100 }, function(err, data, response) {

        if(err) console.log('error searching tweets ' + err.statusCode);
        else {
            console.log('Entering loop....');
            for (i = data.statuses.length - 1; i > 0; i--) {
                var tweetId = data.statuses[i].id_str;
                var userId = data.statuses[i].user.id_str;
                setInterval(function () {

                    bot.post('statuses/retweet/:id', { id: tweetId }, function (err, data, response) {


                        if (err) console.log('Some error occoured in retweeting  ' + err.statusCode);
                        else {

                            console.log('Retweeted successfully...now adding friend');
                            bot.post('friendships/create', { id: userId }, function (err, data, response) {

                                if (err) console.log('Error adding as friend' + err.statusCode);
                                else console.log(' Friend Added successfully ' + response);

                            });

                        }
                    });


                }, 1200000);


            }
        }

    });

},7200000);


function handleError(err) {
    console.error('response status:', err.statusCode);
    console.error('data:', err.data);
}
